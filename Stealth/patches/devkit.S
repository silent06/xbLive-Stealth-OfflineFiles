.include "macros.S"

# ============================================================================
#	Kernel Patches
# ============================================================================

# ============================================================================
#	SataCdRomActivateHCDFRuntimePatch  
#       patch out blacklisted drives for XGD3 discs (zero ExpUpdateModule)
# ============================================================================
	MAKEPATCH 0x800C4FA0
0:
	li   %r11, 0
9:
	MAKEPATCH 0x800C4FC8
0:
	li   %r11, 0
9:

# ============================================================================
#	XexpVerifyMinimumVersion 
#       always return true
# ============================================================================
	MAKEPATCH 0x800A17C0
0:
	li   %r3, 1
9:

# ============================================================================
#	XexpVerifyXexHeaders
#       patch out memcmp of sha
# ============================================================================
	MAKEPATCH 0x800A09F8
0:
	li   %r3, 0x14
9:

# ============================================================================
#	XexpVerifyMediaType
#       remove media type check 
# ============================================================================
	MAKEPATCH 0x8009EEEC
0:
	li   %r3, 1
9:

# ============================================================================
#	XexpVerifyDeviceId 
#       always return 0
# ============================================================================
	MAKEPATCH 0x800A0DC8
0:
	li   %r3, 0
9:

# ============================================================================
#	XexpTranslateAndVerifyBoundPath
#       always return 1
# ============================================================================
	MAKEPATCH 0x8009EE88
0:
	li   %r3, 1
9:

# ============================================================================
#	XexDeltaDecompressHeaders
#       remove hash check
# ============================================================================
	MAKEPATCH 0x800A64A4
0:
	li   %r3, 0x14
9:

# ============================================================================
#	XexpLoadCompressedImage
#       remove hash check
# ============================================================================
	MAKEPATCH 0x800A5BEC
0:
	li   %r3, 0x14
9:

# ============================================================================
#	XexpLoadDeltaCompressedImage
#       remove hash check
# ============================================================================
	MAKEPATCH 0x800A629C
0:
	li   %r3, 0x14
9:

# ============================================================================
#	XeKeysVerifyPIRSSignature
#       always return 1
# ============================================================================
	MAKEPATCH 0x80149EAC
0:
	li   %r3, 1
9:

# ============================================================================
#	XeKeysConsoleSignatureVerification
#       patch flag check  & always return 1
# ============================================================================
	MAKEPATCH 0x8014C01C
0:
	li   %r3, 1
9:
	MAKEPATCH 0x8014C024
0:
	li   %r3, 1
9:

# ============================================================================
#	XeKeysVerifyRSASignature
#       always return 1
# ============================================================================
	MAKEPATCH 0x80149E0C
0:
	li   %r3, 1
9:

# ============================================================================
#	StfsMapNewBlock
#       ignore hash mismatch (patch to unconditional b)
# ============================================================================
	MAKEPATCH 0x800E1FF4
0:
	b 0x34
9:

# ============================================================================
#	StfsNonCachedRead
#       remove hash check (nop out bne)
# ============================================================================
	MAKEPATCH 0x800E4308
0:
	nop
9:

# ============================================================================
#	SvodMapNewBlock
#       remove hash check (unconditional b)
# ============================================================================
	MAKEPATCH 0x801866F8
0:
	b  0x30
9:

# ============================================================================
#	SvodPartiallyCachedRead
#       remove hash check (nop out bne)
# ============================================================================
	MAKEPATCH 0x80186B0C
0:
	nop
9:

# ============================================================================
#	XboxKrnlVersion
#       set to 16547
# ============================================================================
#	MAKEPATCH 0x80040460
#0:
#	.short 16547
#	.short 0
#9:

# ============================================================================
#	XboxKrnlVersion4Digit
#       set to 1888
# ============================================================================
	MAKEPATCH 0x80040468
0:
	.short 1888
	.short 0
9:



# ============================================================================
#	
#    -- XAM  16547  PATCHES --
#
# ============================================================================


# ============================================================================
#	CXChalResp::CheckPkSig
#       remove sig check
# ============================================================================
	MAKEPATCH 0x81AB9424
0:
	nop
9:

# ============================================================================
#	ProfileEmbeddedContent::Validate
#       remove sig check
# ============================================================================
	MAKEPATCH 0x81AB9434
0:
	nop
9:

# ============================================================================
#	XContent::ContentOpenPackageFile
#       ignore hash check
# ============================================================================
	MAKEPATCH 0x819D75D8
0:
	b  -0xFC
9:

# ============================================================================
#	XContent::ContentMountPackage
#       ignore hash check
# ============================================================================
	MAKEPATCH 0x8173411C
0:
	b  0x14
9:

# ============================================================================
#	Change xosd.xex to xosc.xex
# ============================================================================
	MAKEPATCH 0x81688F6C
0:
	.long 0x786F7363  #;// 'xosc'
9:

# ============================================================================
#	Change chalresp/c%uv%u/xosd.xex -> xosc.xex
# ============================================================================
	MAKEPATCH 0x81688F92
0:
	.long 0x786F7363  #;// 'xosc'
9:

# ============================================================================
#	XamExecuteChallenge
#       nop out MmGetPhysicalAddress (so we can access salt ptr)
# ============================================================================
	MAKEPATCH 0x8172BCB8
0:
	nop
9:

# ============================================================================
#	CXNetLogonTask::GetNatType
#       patch out exception in NAT type
# ============================================================================
	MAKEPATCH 0x8181E074
0:
	nop
9:
	MAKEPATCH 0x8181E0A0
0:
	nop
9:
	MAKEPATCH 0x8181E348
0:
	nop
9:

# ============================================================================
#	XMsgStartIORequestEx
#       get rid of annoying dbgprint about missing sysdlls
# ============================================================================
	MAKEPATCH 0x81761318
0:
	li  %r3, 0
9:

# ============================================================================
#	XMsgInProcessCall
#       get rid of annoying dbgprint about missing sysdlls
# ============================================================================
	MAKEPATCH 0x817613D8
0:
	li  %r3, 0
9:

# ============================================================================
#	XMsgSystemProcessCall
#       get rid of annoying dbgprint about missing sysdlls
# ============================================================================
	MAKEPATCH 0x81761550
0:
	li  %r3, 0
9:

# ============================================================================
#	null DEVKIT from end of "\\Device\\Harddisk0\\Partition1\\DEVKIT"
# ============================================================================
	MAKEPATCH 0x815F2EB1
0:
	.long 0x00000000 
9:

# ============================================================================
#	Remove DEVKIT from "\\Device\\Harddisk0\\Partition1\\DEVKIT\\override\\dash.xex"
# ============================================================================
	MAKEPATCH 0x815FCC9C
0:
	.string "override\\dash.xex\0"
	.align 2
9:

# ============================================================================
#	CXnIp::IpLogonGetStatus
#       reboot machine if chal fails
# ============================================================================
	MAKEPATCH 0x8187D1F0
	.set HalReturnToFirmware, 0x81D11DEC
0:
	li   %r3, 4
	MAKEBRANCHL HalReturnToFirmware 
9:

# ============================================================================
#	_XBOX_LIBRARY_VERSION
#       change version to 16537
# ============================================================================
#	MAKEPATCH 0x81D27B44
#0:
#	.short 16547
#	.short 0
#9:

# ============================================================================
#	XamUserCheckPrivilege
#       spoof user privilage
# ============================================================================
	MAKEPATCH 0x817A7F40
0:
	li   %r11, 1
9:
	MAKEPATCH 0x817A7FAC
0:
	li   %r11, 1
9:
	MAKEPATCH 0x817A7FB4
0:
	li   %r11, 1
9:
	MAKEPATCH 0x817A7FA0
0:
	li   %r11, 1
9:

# ============================================================================
#	CXnIp::IpQosShellSort
#       disable assert
# ============================================================================
	MAKEPATCH 0x8189B160
0:
	nop
9:

# ============================================================================
#	CXnIp::IpQosMedian
#       disable assert
# ============================================================================
	MAKEPATCH 0x8189B058
0:
	nop
9:

# ============================================================================
#	End of Patches
.long 0xFFFFFFFF
# ============================================================================
